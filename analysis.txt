Consumer Credit Card Spend Analysis

# Q1. What is the average credit limit?

SELECT AVG(credit_limit) AS avg_credit_limit
FROM customer;

# avg_credit _limit
284700.61


# Q2. Which type of credit card is most commonly held by customers?

SELECT card_type, COUNT(*) AS frequency
FROM customer
GROUP BY card_type
ORDER BY count DESC
LIMIT 1;

# card_type, frequency
Gold, 38


# Q3. What is the average age of credit card holders?

SELECT ROUND(AVG(age)) AS avg_age
FROM customer

# avg_age
46


# Q4. What is the most common spending category?

SELECT product_type, COUNT(*) AS frequency
FROM spend
GROUP BY 1
ORDER BY 2 DESC
LIMIT 1;

# product, frequency
PETROL, 200


# Q5. Show the month-wise spend across the years in descending order.

SELECT MONTHNAME(date) AS month, ROUND(SUM(amount)) AS amount_spend
FROM spend
GROUP BY month
ORDER BY amount_spend DESC;

# month, amount_spend
January, 89421176
March, 56885086
February, 55462858
May, 50668175
April, 35500777
November, 20924385
June, 13514434
July, 11257776
August, 9914366
September, 9213535
October, 6029870
December, 5851637


# Q6. What is the average spend per category?

SELECT product_type, ROUND(AVG(amount)) AS avg_spent
FROM spend
GROUP BY product_type
ORDER BY avg_spent DESC;

# product_type, avg_spent
CLOTHES, 259485
CAMERA, 259260
MOVIE TICKET, 258485
TRAIN TICKET, 250508
SHOPPING, 249649
PETROL, 249316
BUS TICKET, 248028
CAR, 242677
FOOD, 236083
BIKE, 235737
JEWELLERY, 234130
SANDALS, 228973
AIR TICKET, 224187
RENTAL, 223016
AUTO, 200202


# Q7. What is the average no. of transactions per month?

SELECT MONTHNAME(date) AS month, COUNT(*) AS transaction
FROM spend
GROUP BY month
ORDER BY transaction DESC;

# month, transaction
January, 349
February, 238
March, 231
May, 210
April, 150
November, 84
June, 56
July, 42
August, 42
September, 42
October, 28
December, 28


# Q8. List the top 5 cities with the highest amount spent along with their no. of transactions.

WITH top_customers AS (
SELECT customer_id, ROUND(SUM(amount)) AS amount, COUNT(*) AS transaction 
FROM spend
GROUP BY customer_id
ORDER BY amount DESC
)
SELECT city, SUM(amount) AS amount, SUM(transaction) AS transactions
FROM top_customers AS tc
JOIN customer ON customer.customer_id = tc.customer_id
GROUP BY 1
ORDER BY 2 DESC, 3 DESC
LIMIT 5;

# city, amount, transactions
COCHIN, 73495349, 298
BANGALORE, 69342631, 299
CALCUTTA, 64415762, 251
MUMBAI, 50828266, 215
CHENNAI, 32674989, 130


# Q9. List the card types and the amount spent with them over the years.

WITH cust AS (
SELECT customer_id, SUM(amount) AS amount
FROM spend
GROUP BY customer_id
ORDER BY amount DESC
)
SELECT card_type, ROUND(SUM(amount)) AS amount
FROM (SELECT cust.customer_id, card_type, amount
		FROM cust
		JOIN customer ON customer.customer_id = cust.customer_id) as cards
GROUP BY card_type
ORDER BY amount DESC;

# card_type, amount
Gold, 146200355
Platinum, 141314753
Silver, 77128966


# Q10. Which is the most commonly used credit card type?

WITH cust AS (
SELECT customer_id, COUNT(*) AS transactions
FROM spend
GROUP BY customer_id
ORDER BY transactions DESC
)
SELECT card_type, SUM(transactions) AS transactions
FROM (SELECT cust.customer_id, card_type, transactions
		FROM cust
		JOIN customer ON customer.customer_id = cust.customer_id) as cards
GROUP BY card_type
ORDER BY transactions DESC;

# card_type, transactions
Gold, 610
Platinum, 570
Silver, 320


# Q11. What is the average no. of days a customer pays off their credit card bill?

WITH bill AS (
SELECT spend.customer_id, 
	MAX(spend.date) AS spend_date, 
	MAX(repayment.date) AS repayment_date, 
	ABS(DATEDIFF(MAX(repayment.date), MAX(spend.date))) AS days
FROM spend
JOIN customer ON customer.customer_id = spend.customer_id
JOIN repayment ON repayment.customer_id = customer.customer_id
GROUP BY 1
)
SELECT ROUND(AVG(days)) AS avg_days
FROM bill

# avg_days
62

# Q12. What is the rate of late paying customers?

WITH bill AS (
SELECT spend.customer_id,
	MAX(spend.date) AS spend_date, 
	MAX(repayment.date) AS repayment_date, 
	ABS(DATEDIFF(MAX(repayment.date), 
	MAX(spend.date))) AS days
FROM spend
JOIN customer ON customer.customer_id = spend.customer_id
JOIN repayment ON repayment.customer_id = customer.customer_id
GROUP BY 1
)
SELECT CONCAT(ROUND(100 * COUNT(*) / (SELECT COUNT(*) FROM CUSTOMER)), '%') AS late_payment
FROM bill
WHERE days > 30 	#assuming the no. of days to pay off the bill is 30 days

# late_payment
46%



